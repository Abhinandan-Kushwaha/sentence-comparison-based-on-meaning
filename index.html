<html>
    <head>
        <style>
            .btncntnr{
                display: flex;
                justify-content: center;
                margin-top: 40px;
            }
            .btn{
                background-color: aliceblue;
                padding: 10px;
            }
            .btn:hover {
                background-color: aquamarine;
                padding: 10px;
            }
            .extract{
                width: 130px;
                align-self: center;
                padding: 6px;
                margin: 20px;
            }
            .txtar{
                font-size: 20px;
                height: 200px;
            }
            .txtout{
                font-size: 20px;
            }
        </style>
        <script>

            function fn(){
                document.getElementById('comp').style.display = 'none';
            }

            function similarity(s1, s2) {
                var longer = s1;
                var shorter = s2;
                if (s1.length < s2.length) {
                    longer = s2;
                    shorter = s1;
                }
                var longerLength = longer.length;
                if (longerLength == 0) {
                    return 1.0;
                }
                return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
            }
            function editDistance(s1, s2) {
                s1 = s1.toLowerCase();
                s2 = s2.toLowerCase();

                var costs = new Array();
                for (var i = 0; i <= s1.length; i++) {
                    var lastValue = i;
                    for (var j = 0; j <= s2.length; j++) {
                    if (i == 0)
                        costs[j] = j;
                    else {
                        if (j > 0) {
                        var newValue = costs[j - 1];
                        if (s1.charAt(i - 1) != s2.charAt(j - 1))
                            newValue = Math.min(Math.min(newValue, lastValue),
                            costs[j]) + 1;
                        costs[j - 1] = lastValue;
                        lastValue = newValue;
                        }
                    }
                    }
                    if (i > 0)
                    costs[s2.length] = lastValue;
                }
                return costs[s2.length];
            }

            function e1(){
                let str = extract(document.getElementById('i1').value)
                document.getElementById('t1').innerHTML = str

                document.getElementById("r").innerHTML = ""

                if(str && document.getElementById('t2').innerHTML){
                    // console.log('inside if')
                    document.getElementById('comp').style.display = 'block';
                }
                else{
                    // console.log('inside else')
                    document.getElementById('comp').style.display = 'none';
                }
            }

            function e2(){
                let str = extract(document.getElementById('i2').value)
                document.getElementById('t2').innerHTML = str

                document.getElementById("r").innerHTML = ""

                if(str && document.getElementById('t1').innerHTML){
                    // console.log('inside if')
                    document.getElementById('comp').style.display = 'block';
                }
                else{
                    // console.log('inside else')
                    document.getElementById('comp').style.display = 'none';
                }
            }

            function compare(){
                let s1 = document.getElementById('t1').innerHTML
                let s2 = document.getElementById('t2').innerHTML

                if(s1.length < s2.length){  // Make s1 the bigger string
                    temp = s1
                    s1 = s2
                    s2 = temp
                }

                let w1 = s1.split(' ')
                let w2 = s2.split(' ')

                let l1 = w1.length
                let l2 = w2.length

                let maxL = l1
                let minL = l2

                let word1,word2;
                let maxSim=0,sum=0;

                let similarities = []

                for(let i=0;i<maxL;i++){
                    word1 = w1[i]
                    similarities[i]=[]
                    for(j=0;j<minL;j++){
                        word2 = w2[j]
                        similarities[i][j] = similarity(word1,word2)
                        // console.log(`similarities[${i}][${j}] -> `,similarity(word1,word2))
                    }
                }

                console.log('similarities -> ',similarities)

                for(let i=0;i<maxL;i++){
                    maxSim=0;
                    for(j=0;j<minL;j++){
                        if(similarities[i][j] > maxSim){
                            maxSim = similarities[i][j]
                        }
                    }
                    console.log(`maxValue for ${w1[i]} = `, maxSim)

                    sum += maxSim
                }
                console.log('totalSimilarity -->',sum)
                let avgSimilarity = sum/maxL
                console.log('avgSimilarity -->',avgSimilarity)

                document.getElementById("r").innerHTML = "Similarity  =  " + (avgSimilarity*100) + "%"
            }

            function extract(text){
                if(!text) return ''
                let punctuations =['!','@','#','$','%','^','&','+','-','*','_','=','(',')',"'",'"','.',',','<','>',':',';','?','/','\\']
                text = text.trim().split('').filter(character => !punctuations.includes(character)).join('')
                let words = text.toLowerCase().split(' ')

                let tokens=[]
                words.forEach(word=>{
                    if(word && word.trim() && word.trim().length){
                        tokens.push(word.trim())
                    }
                })


                // console.log('tokens '+tokens+'.')

                let articles = ['a','an','the']
                let conjunctions = [
                    'and',
                    'for',
                    'nor',
                    'but',
                    'or',
                    'yet',
                    'so',
                    'after',
                    'although',
                    'as',
                    'as if',
                    'as long as',
                    'as much as',
                    'as soon as',
                    'as though',
                    'because',
                    'before',
                    'by the time',
                    'even if',
                    'if',
                    'in case',
                    'lest',
                    'once',
                    'only if',
                    'since',
                    'so that',
                    'than',
                    'that',
                    'though',
                    'till',
                    'unless',
                    'until',
                    'when',
                    'whenever',
                    'where',
                    'wherever',
                    'while',
                    'until',
                    'both',
                    'either',
                    'neither',
                    'but only',
                    'whether']
                let prepositions = [
                    "a",
                    "abaft",
                    "aboard",
                    "about",
                    "above",
                    "absent",
                    "across",
                    "afore",
                    "after",
                    "against",
                    "along",
                    "alongside",
                    "amid",
                    "amidst",
                    "among",
                    "amongst",
                    "an",
                    "anenst",
                    "apropos",
                    "apud",
                    "around",
                    "as",
                    "aside",
                    "astride",
                    "at",
                    "athwart",
                    "atop",
                    "barring",
                    "before",
                    "behind",
                    "below",
                    "beneath",
                    "beside",
                    "besides",
                    "between",
                    "beyond",
                    "but",
                    "by",
                    "circa",
                    "concerning",
                    "despite",
                    "down",
                    "during",
                    "except",
                    "excluding",
                    "failing",
                    "following",
                    "for",
                    "forenenst",
                    "from",
                    "given",
                    "in",
                    "including",
                    "inside",
                    "into",
                    "lest",
                    "like",
                    "mid",
                    "midst",
                    "minus",
                    "modulo",
                    "near",
                    "next",
                    "notwithstanding",
                    "of",
                    "off",
                    "on",
                    "onto",
                    "opposite",
                    "out",
                    "outside",
                    "over",
                    "pace",
                    "past",
                    "per",
                    "plus",
                    "pro",
                    "qua",
                    "regarding",
                    "round",
                    "sans",
                    "save",
                    "since",
                    "than",
                    "the",
                    "through",
                    "throughout",
                    "till",
                    "times",
                    "to",
                    "toward",
                    "towards",
                    "under",
                    "underneath",
                    "unlike",
                    "until",
                    "unto",
                    "up",
                    "upon",
                    "via",
                    "vice",
                    "with",
                    "within",
                    "without"
                ]

                let auxiliaryVerbs =[
                    'do',
                    'does',
                    'did',
                    'has',
                    'have',
                    'had',
                    'is',
                    'am',
                    'are',
                    'was',
                    'were',
                    'be',
                    'being',
                    'been',
                    'may',
                    'must',
                    'might',
                    'should',
                    'could',
                    'would',
                    'shall',
                    'will',
                    'can'
                ]
                
                // let pronouns = [
                //     'I',
                //     'you',
                //     'my',
                //     'mine',
                //     'myself',
                //     'we',
                //     'us',
                //     'our',
                //     'ours',
                //     'ourselves',
                //     'you',
                //     'you',
                //     'your',
                //     'yours',
                //     'yourself',
                //     'you',
                //     'you',
                //     'your',
                //     'your',
                //     'yourselves',
                //     'he',
                //     'him',
                //     'his',
                //     'his',
                //     'himself',
                //     'she',
                //     'her',
                //     'her',
                //     'her',
                //     'herself',
                //     'it',
                //     'it',
                //     'its',
                //     'itself',
                //     'they',
                //     'them',
                //     'their',
                //     'theirs',
                //     'themself',
                //     'they',
                //     'them',
                //     'their',
                //     'theirs',
                //     'themselves'
                // ]

                let filteredTokens = tokens.filter(tokenItem => !(
                    articles.includes(tokenItem) ||
                    conjunctions.includes(tokenItem) ||
                    prepositions.includes(tokenItem) ||
                    auxiliaryVerbs.includes(tokenItem)
                    ))

                // console.log('filteredTokens -> ',filteredTokens)

                // let sorted = filteredTokens.sort()

                // console.log('sorted -> ',sorted)
                
                return filteredTokens.join(' ')
            }
        </script>
    </head>

    <body style="background-color: azure;" onload="fn()">
        <div class="btncntnr" style="margin-top: 20px;margin-bottom: 40px; font-size: 24px; color: steelblue;">
            <h3>This website compares two sentences and displays the percentage of similarity between them</h2>
        </div>
        <div style="display: flex; width:100%; justify-content: space-evenly;">
            <div style="width: 45%; display: flex; flex-direction: column;">
                Enter Sentence 1
                <textarea class="txtar" id="i1"></textarea>
                <button class="extract" onclick="e1()">Extract Tokens</button>
                <div class="txtout" id="t1"></div>
            </div>
            <div style="width: 45%; display: flex; flex-direction: column;">
                Enter Sentence 2
                <textarea class="txtar" id="i2"></textarea>
                <button class="extract" onclick="e2()">Extract Tokens</button>
                <div class="txtout" id="t2"></div>
            </div>
        </div>
        <div class="btncntnr">
            <button class="btn" id="comp" onclick="compare()">Compare</button>
        </div>
        <div class="btncntnr" style="font-size: 30px; font-weight: bold;" id="r"></div>


        <div style="margin: 10px">
            <h2>How it works</h2>
            <h3>1. Tokenizing and Text pre-processing</h3>
        </div>
        <img src="./sentencePreProcessing.png" style="height:500px; margin-top: 20px;"/>
        <div style="margin-bottom: 10px;">
            <h3>2. Comparing for similarity based on Levenshtein distance</h3>
            <p>
                After preprocessing both the sentences using above approach, compare the 2 output sentences using -
                <a target="_blank" href='https://en.wikipedia.org/wiki/Levenshtein_distance'>Levenshtein distance</a>
            </p>
        </div>
    </body>
</html>